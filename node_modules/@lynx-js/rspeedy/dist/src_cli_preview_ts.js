export const __webpack_ids__ = [
    'src_cli_preview_ts'
];
export const __webpack_modules__ = {
    "./src/cli/preview.ts": function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {
        __webpack_require__.r(__webpack_exports__);
        __webpack_require__.d(__webpack_exports__, {
            preview: ()=>preview
        });
        var node_fs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__("node:fs");
        var _rsbuild_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__("@rsbuild/core");
        var picocolors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__("../../../node_modules/.pnpm/picocolors@1.1.1/node_modules/picocolors/picocolors.js");
        var picocolors__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/ __webpack_require__.n(picocolors__WEBPACK_IMPORTED_MODULE_5__);
        var _exit_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__("./src/cli/exit.ts");
        var _config_loadConfig_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__("./src/config/loadConfig.ts");
        var _create_rspeedy_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__("./src/create-rspeedy.ts");
        async function preview(cwd, previewOptions) {
            try {
                const configPath = (0, _config_loadConfig_js__WEBPACK_IMPORTED_MODULE_3__.Mk)(cwd, previewOptions.config);
                const { content: rspeedyConfig } = await (0, _config_loadConfig_js__WEBPACK_IMPORTED_MODULE_3__.ME)({
                    cwd,
                    configPath
                });
                if (previewOptions.base) {
                    rspeedyConfig.server ??= {};
                    rspeedyConfig.server.base = previewOptions.base;
                }
                const rspeedy = await (0, _create_rspeedy_js__WEBPACK_IMPORTED_MODULE_4__.S)({
                    cwd,
                    rspeedyConfig,
                    ...previewOptions.envMode ? {
                        loadEnv: {
                            mode: previewOptions.envMode
                        }
                    } : {}
                });
                await rspeedy.initConfigs();
                const { distPath } = rspeedy.context;
                if (!node_fs__WEBPACK_IMPORTED_MODULE_0__["default"].existsSync(distPath)) throw new Error(`The output directory ${picocolors__WEBPACK_IMPORTED_MODULE_5___default().yellow(distPath)} does not exist, please build the project before previewing.`);
                await rspeedy.preview();
            } catch (error) {
                _rsbuild_core__WEBPACK_IMPORTED_MODULE_1__.logger.error('Failed to start preview server.');
                _rsbuild_core__WEBPACK_IMPORTED_MODULE_1__.logger.error(error);
                (0, _exit_js__WEBPACK_IMPORTED_MODULE_2__.exit)(1);
                return;
            }
        }
    }
};
